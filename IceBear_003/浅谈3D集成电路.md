---
title: 浅谈3D集成电路
description: 
published: true
date: 2024-09-05T13:40:50.694Z
tags: 前沿, 工艺, 数字
editor: markdown
dateCreated: 2024-08-30T16:42:41.932Z
---

# 初了解3D数字集成电路领域总结

## 简介

由于近年来相关工艺发展趋缓，晶体管尺寸已经接近物理学极限，传统基于平面上的数字集成电路性能受制于芯片的面积、功耗等因素，尤其是“功耗墙”、“内存墙”。为了进一步提升芯片性能，3D集成的概念被提出，即将电路按照一定规则分层放置，不同层之间通过过孔传输信号。3D集成技术突破了芯片发展的瓶颈，从而维持了数字集成电路的高速发展。

## 相关工艺

目前3D集成较多采用TSV3D（Through-Silicon Via 3D）技术。TSV3D技术指将预制好的平面芯片垂直层叠，每层之间加入硅片，在硅片上通孔（TSV）以实现不同电路层的连接。由于层与层之间厚度大，且难以散热，TSV3D技术不适合复杂的3D集成。

相比之下，新兴的M3D（Monolithic 3D）技术在单一硅片上逐层完成电路的搭建，显著降低了不同电路层之间的厚度，比TSV3D小1~2个数量级，减少了层间信号的延迟，适用于庞大复杂的设计。同时，M3D技术加工的芯片由于热在垂直方向上传导快，有较好的散热性能。最重要的是，M3D芯片中的层间过孔MIV（Monolithic Interlayer Via）直径远小于TSV（1~2个数量级），大幅降低3D集成电路的占用空间，为细粒划分等复杂设计提供了条件。下面第一张图为上下两层M3D的横截面示意图，其中绿色的就是贯穿层间硅片的过孔MIV，第二张图为MIV过孔和TSV过孔直径的直观大小比较图，可以看到MIV真的很小很小，这为粒度更细、布线更密集的集成电路设计创造了条件。

<img src="https://gitee.com/HamsterYDS/MyImages/raw/master/imgs/image-20240905203853080.png" alt="image-20240905203853080" style="zoom:50%;" />

<img src="https://gitee.com/HamsterYDS/MyImages/raw/master/imgs/image-20240905203918159.png" alt="image-20240905203918159" style="zoom:50%;" />

无论是哪种工艺，本质上都是多层平面叠加在一起，平面与平面之间存在带有过孔的夹层，类似于多层PCB的结构。而层内、层间的布线都可在相应的EDA中自动化排布，科研工作者们需要探究的不仅有如何将系统设计成多层的三维结构，还有该如何进行这样的设计，让最终结果具有更好的性能（面积更小、功耗更低、散热更好等），并得到三维集成电路设计的基本规律、优化技巧。

## 设计方法

虽然3D集成相比传统2D集成提升了一个维度，但是其设计过程并没有发生非常大的改变，因为每一层内的电路仍然是普通的2D集成，只需要额外考虑层间过孔。设计3D数字集成电路时，一般从传统的平面结构出发，将整个系统进行合理的分割，排布到不同层，以下是一些分割的思路。

### 按规模（大小等级）分割

> **晶体管级**：将N-type和P-type的晶体管分开来，放置于不同层。
> 优点：对不同层不同类型的晶体管进行独立的优化，两层间无需金属夹层。
> 缺点：需要重新设计晶体管以迎合分割模式，每对晶体管都需要一个过孔，占用面积提升10%~20%。

> **门级/亚块级**：对逻辑块、内存块内部进行分割，块内的不同门可能处于相同层/不同层。
> 优点：可以使用现成的标准CMOS库进行设计，小幅度减少层间过孔的数量，大幅度降低芯片占用空间，提升关键路径的性能。
> 缺点（个人意见）：设计者需要对每个模块都进行相应的分割优化，工作量较大。
>
> 例1、SRAM阵列可在门级被分割，将庞大的译码器、多选器和大量的存储单元分层放置，将存储单元分为多个部分分层放置，将不同读写端口分层放置。这样可以优化SRAM结构的读写延迟、功耗和占用面积（优化程度受数据结构本身的参数和规模影响）。
>
> <img src="https://gitee.com/HamsterYDS/MyImages/raw/master/imgs/image-20240905204346486.png" alt="image-20240905204346486" style="zoom:50%;" />

> **块级**：按照块的功能进行分割
> 优点：具有和门级分割相似的优点，线长优化（不如门级分割），具有最少的过孔数量（适用于TSV3D工艺）。
> 缺点：由于分割的粒度过大，使得设计灵活性降低，对关键路径几乎没有优化。
>
> 例1、总线结构的NoC在三维层面上可被折叠，即总线每处都与上下两个核连接，长度至少可减少一半。
>
> <img src="https://gitee.com/HamsterYDS/MyImages/raw/master/imgs/image-20240905204422201.png" alt="image-20240905204422201" style="zoom:50%;" />
>
> 例2、在三维加速CPU结构中，插入FDR层实现硬件加速效果，FDR和核心在底层通过L2总线/Crossbar连接到中间的L2 Cache层，L2 Cache与顶层的RRAM通过MSHR模块交互。（具体机制见后文）

### 基于M3D工艺各层异质性的分割思路

由于M3D工艺要求三维芯片被从下至上逐层加工，加工上层释放的大量的热可能会破坏下层的结构。使用laser-scan技术可避免这个问题，这降低了上层的加工温度（不会对下层造成破坏），但牺牲了一部分上层的性能。

因此M3D加工得到的3D集成电路上下层在性能、材料方面都有区别，可描述为各层的“异质性”，下层晶体管一般较小，性能高，上层晶体管较大，性能稍低。在对系统进行分割时，尤其是门级/亚块级分割时，需要考虑、利用“异质性”。

> 以门级/亚块级分割为例，具体的策略有：
>
> - 逻辑结构
>
>   - 块内关键路径置于下层（性能高，降低延时），非关键路径置于上层（性能稍低但无关紧要）。
>     e.g. 基于超前进位的64位加法器从最低的进位传播到最高的加和结果的路径最长，将其置于下层，减少其的延迟。
>
>     <img src="https://gitee.com/HamsterYDS/MyImages/raw/master/imgs/image-20240905204844657.png" alt="image-20240905204844657" style="zoom:50%;" />
>
> - 存储结构
>
>   - 端口分割（PP）：将读写端口非对称地分割于不同层，上层使用较大的晶体管
>
>   - 位/字分割（BP/WP）：将SRAM所有存储单元非对称地分割于不同层，更多的存储单元放置于底层
>
>   - 具体采用以下那种策略，需要考虑结构本身的参数，例如下图M3D工艺下的Register File采用PP是因为其需要实现多端口读写（寄存器堆需要极多的读写端口，故减半每层的端口数量以大幅降低字线和位线的长度，获取更多的时序优化）；而Branch Pattern Table由于深度极大，宽度极小，故采用WP（减半位线以获取更多的时序优化）。
>
>     <img src="https://gitee.com/HamsterYDS/MyImages/raw/master/imgs/image-20240905205005040.png" alt="image-20240905205005040" style="zoom:50%;" />
>
> - 混合结构
>
>   - 同时采用上面两种结构的分割策略
>     e.g. 寄存器重命名的子系统中同时包含Register Alias Table（寄存器重命名表，一个多读写端口的存储结构）和一些检查逻辑，后者不是关键路径，因此可被放置在性能稍低的上层，而RAT较为庞大的译码器被放置在性能高的下层。

## 应用

### 三维CPU-FPGA系统

利用FDR架构可以生成用以加速片上运算的FDR层。其利用了可被重配置的Logic Elements（模拟LUTs或内部连线等结构）、SRAM块和DSP块，将运算压缩至较小的空间内，消除了传统FPGA中全局连线过长的问题。可重配置的LE受到其所属的”影子“SRAM控制，后者随着时间推移，来回切换LE的状态和逻辑，让同一个LE可以模拟流水线中不同周期的逻辑运算，提升子系统的硬件复用率。

下图则是一个3D CPU结构，其中插入了FDR加速层。可以注意到，FDR加速层和CPU核心虽然在上下不同层，但是都通过L2总线/Crossbar通道与L2 Cache进行交互，（个人认为）这里FDR-L2 Cache可以看作一个存算一体的结构，一些运算过程无需经过复杂的CPU Core，而是在FDR层完成运算，结果直接被写回L2 Cache，大大缩短了运算时间。

<img src="https://gitee.com/HamsterYDS/MyImages/raw/master/imgs/image-20240905204507061.png" alt="image-20240905204507061" style="zoom: 50%;" />

研究表明，该三维CPU-FPGA系统，在以运算为主的压力测试下速度为传统CPU的43.1倍，功耗下降了接近40倍；在以存储为主的压力测试下速度为传统CPU的2.5倍，功耗下降了接近4倍。该案例证明了3D数字集成电路的潜力。

### AMD 3D V-Cache技术

近几个月爆出的Intel高性能CPU缩缸事件，无疑对CPU市场造成了巨大冲击。与受影响的IntelCPU型号对标的AMD 7800x3d价格在短短几天内飙升，从2000升到3200。7800x3d在游戏上优秀的性能表现一直为大家所称赞，后缀“x3d”代表其引入了3D V-Cache技术，而这正是该款CPU具有极高的游戏性能的主要原因。

3D V-Cache（Three Dimension Vertical Cache）指3D垂直缓存，是一种创新的芯片堆叠技术，其在CPU CCD的上方堆叠大面积的L3 Cache，通过TSV连接上下两层，使得缓存容量得以增加，带来游戏性能的提升。可以注意到，该技术采用的是上面所提到的块分割，即将L3 Cache分割出来单独成层，故过孔数量不大，可以使用TSV3D工艺实现（这也是目前的方案）。

<img src="https://gitee.com/HamsterYDS/MyImages/raw/master/imgs/v2-2077b679daafdecb564dbf5f6f308e0d_1440w.webp" alt="img" style="zoom:50%;" />

## 挑战

**散热**：3D集成电路对散热的要求更高，因为其散热面积少于传统的平面集成电路。

**工具链**：3D集成电路的自动化设计工具链发展尚未成熟，无法做到从设计到验证仿真一体化。

**设计方式**：3D集成电路的设计方式仍是领域前沿正在探索的问题，科研工作者正致力于优化设计模式，开发全新的体系架构（而非迁移传统平面上的体系架构），以达到更好的指标。

## 参考文献

- ***Designing Vertical Processors in Monolithic 3D*** By Bhargava Gopireddy and Josep Torrellas
- ***A Monolithic 3D Hybrid Architecture for Energy-Efficient Computation*** By Ye Yu and Niraj K. Jha
- **《3D集成电路设计——EDA、设计和微体系结构》** By Yuan Xie, Jason Cong and Sachin Sapatnekar

